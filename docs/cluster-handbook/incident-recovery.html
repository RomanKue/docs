<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/WADTFY/wadtfy-docs/assets/css/just-the-docs-default.css"> <script src="/WADTFY/wadtfy-docs/assets/js/vendor/lunr.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js"></script> <script src="/WADTFY/wadtfy-docs/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Incident Recovery | WADTFY</title> <meta name="generator" content="Jekyll v4.3.2" /> <meta property="og:title" content="Incident Recovery" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="WADTFY Docs" /> <meta property="og:description" content="WADTFY Docs" /> <link rel="canonical" href="https://pages.atc-github.azure.cloud.bmw/WADTFY/wadtfy-docs//WADTFY/wadtfy-docs/cluster-handbook/incident-recovery.html" /> <meta property="og:url" content="https://pages.atc-github.azure.cloud.bmw/WADTFY/wadtfy-docs//WADTFY/wadtfy-docs/cluster-handbook/incident-recovery.html" /> <meta property="og:site_name" content="WADTFY" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Incident Recovery" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"WADTFY Docs","headline":"Incident Recovery","url":"https://pages.atc-github.azure.cloud.bmw/WADTFY/wadtfy-docs//WADTFY/wadtfy-docs/cluster-handbook/incident-recovery.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Feather. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/WADTFY/wadtfy-docs/" class="site-title lh-tight"> WADTFY </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/WADTFY/wadtfy-docs/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in AppDev Handbook category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/WADTFY/wadtfy-docs/app-dev-handbook/" class="nav-list-link">AppDev Handbook</a><ul class="nav-list "><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/getting-started.html" class="nav-list-link">Getting Started</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/unity-app-yaml.html" class="nav-list-link">Unity App Yaml</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/connect-it.html" class="nav-list-link">Connect IT</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/app-configuration.html" class="nav-list-link">App Configuration</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/authentication-and-authorization.html" class="nav-list-link">Authentication and Authorization</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/resources.html" class="nav-list-link">Resources</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/urls.html" class="nav-list-link">URLs</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/certificates.html" class="nav-list-link">Certificates</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/security.html" class="nav-list-link">Security</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/telemetry.html" class="nav-list-link">Telemetry</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/external-services.html" class="nav-list-link">External Services</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/http-headers.html" class="nav-list-link">HTTP Headers</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/maven-packages.html" class="nav-list-link">Maven Packages</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/kubernetes.html" class="nav-list-link">Kubernetes</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/diagnostics.html" class="nav-list-link">Diagnostics</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/postgresql-flexible-server.html" class="nav-list-link">PostgreSQL Flexible Server</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/decommissioning-app.html" class="nav-list-link">Decommission App</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in DevOps Handbook category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/WADTFY/wadtfy-docs/cluster-handbook/" class="nav-list-link">DevOps Handbook</a><ul class="nav-list "><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/architecture.html" class="nav-list-link">Architecture</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/networking.html" class="nav-list-link">Networking</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/kubernetes.html" class="nav-list-link">Kubernetes</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/envoy.html" class="nav-list-link">Envoy</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/certs.html" class="nav-list-link">Certs</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/technical-accounts.html" class="nav-list-link">Technical Accounts</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/regular-activities.html" class="nav-list-link">Regular Activities</a></li><li class="nav-list-item active"><a href="/WADTFY/wadtfy-docs/cluster-handbook/incident-recovery.html" class="nav-list-link active">Incident Recovery</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/database-incident-recovery.html" class="nav-list-link">Database Incident Recovery</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/alerts.html" class="nav-list-link">Alerts</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/restore-decommissioned-app.html" class="nav-list-link">Restore decommission App</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/cluster-migration.html" class="nav-list-link">Cluster Migration</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/references.html" class="nav-list-link">References</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/accesses.html" class="nav-list-link">Accesses</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/postgresql-flexible-server.html" class="nav-list-link">PostgreSQL Flexible Server</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search WADTFY" aria-label="Search WADTFY" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://argocd.api-i.bmwgroup.net" class="site-button" > Int </a> </li> <li class="aux-nav-list-item"> <a href="https://argocd.api.bmwgroup.net" class="site-button" > Prod </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/WADTFY/wadtfy-docs/cluster-handbook/">DevOps Handbook</a></li> <li class="breadcrumb-nav-list-item"><span>Incident Recovery</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><strong>Table of Contents</strong></p> <!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> <ul> <li><a href="#incident-recovery">Incident Recovery</a> <ul> <li><a href="#fix-broken-service-account-token">Fix Broken Service Account Token</a></li> <li><a href="#fix-missing-or-broken-master-key">Fix Missing or Broken Master Key</a></li> <li><a href="#fix-crashing-unity-operator">Fix Crashing UNITY Operator</a></li> <li><a href="#automatic-alerts">Automatic Alerts</a> <ul> <li><a href="#known-issues">Known Issues</a></li> </ul> </li> </ul> </li> </ul> <!-- END doctoc generated TOC please keep comment here to allow auto update --> <h1 id="incident-recovery"> <a href="#incident-recovery" class="anchor-heading" aria-labelledby="incident-recovery"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Incident Recovery </h1> <p>The sections below describe certain incidents and how to recover from them.</p> <h2 id="fix-broken-service-account-token"> <a href="#fix-broken-service-account-token" class="anchor-heading" aria-labelledby="fix-broken-service-account-token"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Fix Broken Service Account Token </h2> <p>It may happen that the service account token stored in GHE secrets gets invalid or the user deletes it by accident.</p> <p>This can be fixed by running the <a href="https://atc-github.azure.cloud.bmw/UNITY/unity/actions/workflows/recreate-app-service-account.yaml"><code class="language-plaintext highlighter-rouge">recreate-app-service-account</code></a> workflow, which recreates the token on the k8s cluster and stores it in the GHE secrets for the selected environment and repos matching the specified regular expression.</p> <h2 id="fix-missing-or-broken-master-key"> <a href="#fix-missing-or-broken-master-key" class="anchor-heading" aria-labelledby="fix-missing-or-broken-master-key"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Fix Missing or Broken Master Key </h2> <p>To encrypt the secrets in an automated way, the master key must be stored in GHE.</p> <p>This (or fixing a broken master key) can be achieved by running the <a href="https://atc-github.azure.cloud.bmw/UNITY/unity/actions/workflows/sync-master-keys-from-k8s-to-gh.yaml"><code class="language-plaintext highlighter-rouge">sync-master-keys-from-k8s-to-gh</code></a> workflow, which stores the master key in GHE for the selected environment and repos matching the specified regular expression as <code class="language-plaintext highlighter-rouge">CRYPT_MASTER_KEY</code> (or updates the existing one if overwrite is set to true).</p> <h2 id="fix-crashing-unity-operator"> <a href="#fix-crashing-unity-operator" class="anchor-heading" aria-labelledby="fix-crashing-unity-operator"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Fix Crashing UNITY Operator </h2> <p>In case, the UNITY operator is in a crashing looping state, because one app is configured such that it breaks the operator (which should not happen). To make sure the UNITY operator gets into normal state, one can exclude an app (causing the issue) from being handled by the unity-operator.</p> <p>To do so, annotate the app’s secret with <code class="language-plaintext highlighter-rouge">unity-operator.unity.bmwgroup.net/disabled: 'true'</code>. This can be done by running</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl annotate secret app-foo <span class="nt">--overwrite</span> unity-operator.unity.bmwgroup.net/disabled<span class="o">=</span><span class="nb">true</span>
</code></pre></div></div> <p>⚠️ After the root cause of the issue was solved, the annotation must be set back to <code class="language-plaintext highlighter-rouge">false</code> manually.</p> <h2 id="automatic-alerts"> <a href="#automatic-alerts" class="anchor-heading" aria-labelledby="automatic-alerts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Automatic Alerts </h2> <p>There are several automatic alerts which result in both Teams messages on the configured channels and ITSM incidents being created. The situations which result in automatic alerts are the following:</p> <ul> <li> <p>when one of the platform components is not working on either INT or PROD (unity-operator, oauth2-proxy, grafana, grafana-tempo). In this case, the UNITY team needs to analyze the problem and come up with a solution (a quick temporary fix to bring the component back into a running state and, if necessary, a follow-up fix in the code to prevent the problem from occurring again)</p> </li> <li> <p>when an application is not working on PROD. In this case, the UNITY team needs to analyze the problem and determine if it is caused by the platform or by the application. In case the problem is caused by the platform, the same steps which are done in case platform components are done, need to be followed here. In case the problem is within the application, it needs to be informed (via an incident).</p> </li> </ul> <p>The service group corresponding to an application can be found in <a href="https://connectit.muc">Connect IT</a>, under the tab <code class="language-plaintext highlighter-rouge">CMDB Information</code> (after searching for the application, by application ID)</p> <p><img src="../assets/connectit.png" alt="" /></p> <h3 id="known-issues"> <a href="#known-issues" class="anchor-heading" aria-labelledby="known-issues"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Known Issues </h3> <p>The following alert is triggered because the total memory limit is higher than the available memory in the cluster.</p> <p><img src="../assets/memory-overcommit-alert.png" alt="" /></p> <p>This is not be a problem unless the applications are simultaneously requesting more memory than the property set in <code class="language-plaintext highlighter-rouge">container.resources.requests</code> in their <code class="language-plaintext highlighter-rouge">unity-app.*.yaml</code>, which is highly unlikely (for more information see the <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#requests-and-limits">official documentation</a>).</p> <p>If this still happens, the problem can be fixed by raising the <code class="language-plaintext highlighter-rouge">container.resources.requests</code> to a value which is closer to the <code class="language-plaintext highlighter-rouge">container.resources.limits</code>, which should trigger the creation of new nodes by the autoscaler.</p> </div> </div> <div class="search-overlay"></div> </div> <script> var config = { theme: "dark" } ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script> </body> </html>
