<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/WADTFY/wadtfy-docs/assets/css/just-the-docs-default.css"> <script src="/WADTFY/wadtfy-docs/assets/js/vendor/lunr.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js"></script> <script src="/WADTFY/wadtfy-docs/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Telemetry | WADTFY</title> <meta name="generator" content="Jekyll v4.3.2" /> <meta property="og:title" content="Telemetry" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="WADTFY Docs" /> <meta property="og:description" content="WADTFY Docs" /> <link rel="canonical" href="https://pages.atc-github.azure.cloud.bmw/WADTFY/wadtfy-docs//WADTFY/wadtfy-docs/onboarding-handbook/telemetry.html" /> <meta property="og:url" content="https://pages.atc-github.azure.cloud.bmw/WADTFY/wadtfy-docs//WADTFY/wadtfy-docs/onboarding-handbook/telemetry.html" /> <meta property="og:site_name" content="WADTFY" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Telemetry" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"WADTFY Docs","headline":"Telemetry","url":"https://pages.atc-github.azure.cloud.bmw/WADTFY/wadtfy-docs//WADTFY/wadtfy-docs/onboarding-handbook/telemetry.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Feather. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/WADTFY/wadtfy-docs/" class="site-title lh-tight"> WADTFY </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/WADTFY/wadtfy-docs/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Onboarding Handbook category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/WADTFY/wadtfy-docs/onboarding-handbook/" class="nav-list-link">Onboarding Handbook</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Cluster Handbook category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/WADTFY/wadtfy-docs/cluster-handbook/" class="nav-list-link">Cluster Handbook</a><ul class="nav-list "></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search WADTFY" aria-label="Search WADTFY" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://argocd.api-i.bmwgroup.net" class="site-button" > Int </a> </li> <li class="aux-nav-list-item"> <a href="https://argocd.api.bmwgroup.net" class="site-button" > Prod </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="">AppDev Handbook</a></li> <li class="breadcrumb-nav-list-item"><span>Telemetry</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><strong>Table of Contents</strong></p> <!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> <ul> <li><a href="#telemetry">Telemetry</a> <ul> <li><a href="#logging">Logging</a> <ul> <li><a href="#search-in-logs">Search in Logs</a></li> <li><a href="#live-logs">Live Logs</a></li> </ul> </li> <li><a href="#metrics">Metrics</a> <ul> <li><a href="#custom-metrics">Custom Metrics</a></li> </ul> </li> <li><a href="#itsm-alerting">ITSM Alerting</a></li> <li><a href="#tracing">Tracing</a></li> </ul> </li> </ul> <!-- END doctoc generated TOC please keep comment here to allow auto update --> <h1 id="telemetry"> <a href="#telemetry" class="anchor-heading" aria-labelledby="telemetry"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Telemetry </h1> <p>Telemetry data jointly refers to logs, metrics, traces and other diagnostic data of your app.</p> <h2 id="logging"> <a href="#logging" class="anchor-heading" aria-labelledby="logging"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Logging </h2> <p>Application logs can be accessed in Grafana:</p> <ul> <li><a href="https://unity-int.bmwgroup.net/grafana/">Grafana int</a></li> <li><a href="https://unity.bmwgroup.net/grafana/">Grafana</a></li> </ul> <p>In the <strong>Explore</strong> tab, logs can be searched by selecting <strong>Loki</strong> as datasource.</p> <p><img src="../assets/explore-loki.png" alt="" /></p> <h3 id="search-in-logs"> <a href="#search-in-logs" class="anchor-heading" aria-labelledby="search-in-logs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Search in Logs </h3> <p>Logs can be search using <a href="https://grafana.com/docs/loki/latest/logql/">LogQL</a>.</p> <p><img src="../assets/loki-logs.png" alt="" /></p> <p>Here are a few examples to start with:</p> <ul> <li>Select logs for the <code class="language-plaintext highlighter-rouge">app-test</code>’s <code class="language-plaintext highlighter-rouge">api</code> component from the <code class="language-plaintext highlighter-rouge">main</code> container: <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{app="app-test", component="api", container="main"}
</code></pre></div> </div> </li> <li>Find logs containing the word <code class="language-plaintext highlighter-rouge">NullPointerException</code> in the logs <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{app="app-test", component="api", container="main"} |= `NullPointerException`
</code></pre></div> </div> </li> <li>Select logs for multiple containers: <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{app="app-test", component="api", container=~"main|authz|envoy"}
</code></pre></div> </div> </li> <li>Select logs by querying a json property (works with JSON logs only) <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{app="app-test", component="api", container=~"main"} | json | level="WARN"
</code></pre></div> </div> </li> <li>Print only part of a JSON log entry: <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{app="app-test", component="api", container=~"main"} | json | line_format ""
</code></pre></div> </div> </li> </ul> <h3 id="live-logs"> <a href="#live-logs" class="anchor-heading" aria-labelledby="live-logs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Live Logs </h3> <p>To follow logs of an app’s component, select the relevant logs by label and click the <strong>Live</strong> button, the logs will update automatically.</p> <video autoplay="" loop="" width="801"> <source src="../assets/live-logs.mov" type="video/mp4" /> Your browser does not support the video tag. </video> <h2 id="metrics"> <a href="#metrics" class="anchor-heading" aria-labelledby="metrics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Metrics </h2> <p>Application metrics can be accessed in Grafana:</p> <ul> <li><a href="https://unity-int.bmwgroup.net/grafana/">Grafana int</a></li> <li><a href="https://unity.bmwgroup.net/grafana/">Grafana</a></li> </ul> <p>In the <strong>Explore</strong> tab, metrics be explored by selecting <strong>Prometheus</strong> as datasource.</p> <p><img src="../assets/explore-prometheus.png" alt="" /></p> <p>Metrics can be explored using <a href="https://prometheus.io/docs/prometheus/latest/querying/basics/">PromQL</a>.</p> <p>Here are a few examples to start with:</p> <ul> <li>Select the <code class="language-plaintext highlighter-rouge">up</code> metric and sum by component: <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sum (up{app="app-test"}) by (component)
</code></pre></div> </div> </li> <li>Show absolute memory usage in MB <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>avg(container_memory_working_set_bytes{pod=~"app-test-api-.*", container=~"main"}) by (pod, container) / 1e6
</code></pre></div> </div> </li> <li>Show memory usage relative to limits <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>avg(container_memory_working_set_bytes{pod=~"app-test-api-.*", container=~"main"}) by (pod, container)
/ avg(kube_pod_container_resource_limits{pod=~"app-test-api-.*", container=~"main", resource="memory"} &gt; 0) by (pod, container)
</code></pre></div> </div> </li> <li>Show memory usage relative to requests <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>avg(container_memory_working_set_bytes{pod=~"app-test-api-.*", container=~"main"}) by (pod, container)
/ avg(kube_pod_container_resource_requests{pod=~"app-test-api-.*", container=~"main", resource="memory"} &gt; 0) by (pod, container)
</code></pre></div> </div> </li> </ul> <h3 id="custom-metrics"> <a href="#custom-metrics" class="anchor-heading" aria-labelledby="custom-metrics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Custom Metrics </h3> <p>If the application wants to monitor its own metrics, this can be done be defining the metrics endpoint as follows:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deployments</span><span class="pi">:</span>
  <span class="na">api</span><span class="pi">:</span>
    <span class="na">container</span><span class="pi">:</span>
      <span class="na">metrics</span><span class="pi">:</span> <span class="s">/my-app/api/metrics</span>
</code></pre></div></div> <p>In this case the endpoint <code class="language-plaintext highlighter-rouge">/my-app/api/metrics</code> will be scraped and the exposed metrics can be explored as described above. This endpoint will be available only from within the Kubernetes cluster. It will not be possible to access the metrics endpoint via the ingress (for example <code class="language-plaintext highlighter-rouge">https://unity.bmwgroup.net/my-app/api/metrics</code> will be forbidden).</p> <p>Using a labeling where the cardinality of the value set is high (e.g. email address) can dramatically increase the amount of data stored (for more information please refer to <a href="https://prometheus.io/docs/practices/naming">Prometheus’s official guide</a>). Therefore, there are some limitations regarding the custom metrics to prevent overloading and killing the time series database:</p> <ul> <li>The maximum number of labels per sample is 10</li> <li>The maximum number of samples per scrape is 200</li> </ul> <h2 id="itsm-alerting"> <a href="#itsm-alerting" class="anchor-heading" aria-labelledby="itsm-alerting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ITSM Alerting </h2> <p>It is possible to define <a href="https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules">Prometheus Alerting Rules</a> which can be configured to trigger incident creation. The prerequisite for this is a valid monitor contract ID (MCID) which can be created in the <a href="http://systemsmgmt-portal.bmwgroup.net">Application Monitoring Database</a>.</p> <p>An alert can then be configured as follows:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">appId</span><span class="pi">:</span> <span class="s">APP-1234</span>
<span class="na">deployments</span><span class="pi">:</span>
  <span class="na">api</span><span class="pi">:</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">container</span><span class="pi">:</span>
    <span class="c1"># Container configuration</span>
<span class="na">alerts</span><span class="pi">:</span>
  <span class="na">foo_total</span><span class="pi">:</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">Foo_total has reached 10 for label 'prom-rule-test'.</span>
    <span class="na">expr</span><span class="pi">:</span> <span class="s">foo_total{metric="prom-rule-test"} &gt; </span><span class="m">10</span>
    <span class="na">for</span><span class="pi">:</span> <span class="s">10m</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="c1"># itsm_app_id: APP-789 # optional APP-ID from the MCID. Only required if different from the appId provided above</span>
      <span class="na">itsm_contract_id</span><span class="pi">:</span> <span class="s">10APP123456789</span> <span class="c1"># your MCID from the Application Monitoring Database</span>
      <span class="na">itsm_enabled</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">itsm_event_id</span><span class="pi">:</span> <span class="s">foo_total_reached_10</span>
      <span class="na">itsm_severity</span><span class="pi">:</span> <span class="s">MINOR</span>
      <span class="na">severity</span><span class="pi">:</span> <span class="s">other</span>
    <span class="na">summary</span><span class="pi">:</span> <span class="s">Foo_total is greater then </span><span class="m">10</span>
</code></pre></div></div> <p>For more information regarding alerts integration please refer to <a href="https://developer.bmwgroup.net/docs/4wheels-managed/applications_integration/monitoring/#alerts-integration">4Wheels Managed</a> documentation.</p> <h2 id="tracing"> <a href="#tracing" class="anchor-heading" aria-labelledby="tracing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tracing </h2> <p>Tracing is not available yet.</p> </div> </div> <div class="search-overlay"></div> </div> <script> var config = { theme: "dark" } ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script> </body> </html>
