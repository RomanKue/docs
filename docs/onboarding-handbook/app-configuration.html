<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/WADTFY/wadtfy-docs/assets/css/just-the-docs-default.css"> <script src="/WADTFY/wadtfy-docs/assets/js/vendor/lunr.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js"></script> <script src="/WADTFY/wadtfy-docs/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>App Configuration | WADTFY</title> <meta name="generator" content="Jekyll v4.3.2" /> <meta property="og:title" content="App Configuration" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="WADTFY Docs" /> <meta property="og:description" content="WADTFY Docs" /> <link rel="canonical" href="https://pages.atc-github.azure.cloud.bmw/WADTFY/wadtfy-docs//WADTFY/wadtfy-docs/onboarding-handbook/app-configuration.html" /> <meta property="og:url" content="https://pages.atc-github.azure.cloud.bmw/WADTFY/wadtfy-docs//WADTFY/wadtfy-docs/onboarding-handbook/app-configuration.html" /> <meta property="og:site_name" content="WADTFY" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="App Configuration" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"WADTFY Docs","headline":"App Configuration","url":"https://pages.atc-github.azure.cloud.bmw/WADTFY/wadtfy-docs//WADTFY/wadtfy-docs/onboarding-handbook/app-configuration.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Feather. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/WADTFY/wadtfy-docs/" class="site-title lh-tight"> WADTFY </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/WADTFY/wadtfy-docs/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Onboarding Handbook category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/WADTFY/wadtfy-docs/onboarding-handbook/" class="nav-list-link">Onboarding Handbook</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Cluster Handbook category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/WADTFY/wadtfy-docs/cluster-handbook/" class="nav-list-link">Cluster Handbook</a><ul class="nav-list "></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search WADTFY" aria-label="Search WADTFY" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://argocd.api-i.bmwgroup.net" class="site-button" > Int </a> </li> <li class="aux-nav-list-item"> <a href="https://argocd.api.bmwgroup.net" class="site-button" > Prod </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="">AppDev Handbook</a></li> <li class="breadcrumb-nav-list-item"><span>App Configuration</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><strong>Table of Contents</strong></p> <!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> <ul> <li><a href="#app-configuration">App Configuration</a> <ul> <li><a href="#environment-variables">Environment Variables</a></li> <li><a href="#secrets">Secrets</a> <ul> <li><a href="#encrypt-in-the-browser">Encrypt in the Browser</a></li> <li><a href="#encrypt-via-gh">Encrypt via <code class="language-plaintext highlighter-rouge">gh</code></a></li> </ul> </li> <li><a href="#headers-and-cookies">Headers and Cookies</a></li> <li><a href="#prototypes">Prototypes</a></li> <li><a href="#environment-configuration-with-angular">Environment Configuration with Angular</a></li> </ul> </li> </ul> <!-- END doctoc generated TOC please keep comment here to allow auto update --> <h1 id="app-configuration"> <a href="#app-configuration" class="anchor-heading" aria-labelledby="app-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> App Configuration </h1> <p>Apps may need environment specific configuration, such as URLs to external systems or secret information like client-ids.</p> <h2 id="environment-variables"> <a href="#environment-variables" class="anchor-heading" aria-labelledby="environment-variables"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Environment Variables </h2> <p>Environment variables can be configured in the <code class="language-plaintext highlighter-rouge">unity-app.*.yaml</code> files.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deployments</span><span class="pi">:</span>
  <span class="na">api</span><span class="pi">:</span>
    <span class="c1"># ...</span>
    <span class="na">container</span><span class="pi">:</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="na">FOO</span><span class="pi">:</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">some-value</span>
        <span class="na">BAR</span><span class="pi">:</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">another-value</span>
</code></pre></div></div> <p>The values may be set specific to the environment.</p> <p>Especially with <a href="https://quarkus.io">Quarkus</a>, environment variables can be used to set all <a href="https://quarkus.io/guides/config-reference#configuration-sources">Config Sources</a>. Other configuration mechanisms, like config files, are currently not supported.</p> <h2 id="secrets"> <a href="#secrets" class="anchor-heading" aria-labelledby="secrets"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Secrets </h2> <p>To configure an app with secret information, values can be stored in encrypted form in the <code class="language-plaintext highlighter-rouge">unity-app.*.yaml</code> files.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deployments</span><span class="pi">:</span>
  <span class="na">api</span><span class="pi">:</span>
    <span class="c1"># ...</span>
    <span class="na">container</span><span class="pi">:</span>
      <span class="na">secretEnv</span><span class="pi">:</span>
        <span class="na">PASSWORD</span><span class="pi">:</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">crypt.v1[atAkljasdjs/0==]</span>
</code></pre></div></div> <p>To encrypt a value, run the <code class="language-plaintext highlighter-rouge">encrypt</code> workflow in your repository.</p> <p>There are two ways to do this, via the browser or via <a href="https://cli.github.com"><code class="language-plaintext highlighter-rouge">gh</code></a>. For experts, the preferred way should be using <code class="language-plaintext highlighter-rouge">gh</code>, since there is no risk of caching secret data in the browser.</p> <p>Secrets will be available in decrypted form inside the container as environment variable. This means that any user that has access to the container can view the secret values, e.g. by running <code class="language-plaintext highlighter-rouge">env</code>. Ideally, secret environment variables would be unset or overwritten after reading them from the application to avoid exposing them to a potential attacker. However, this is not possible at the moment out of the box.</p> <h3 id="encrypt-in-the-browser"> <a href="#encrypt-in-the-browser" class="anchor-heading" aria-labelledby="encrypt-in-the-browser"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Encrypt in the Browser </h3> <p><img src="../assets/actions-encrypt-workflow.png" alt="" /></p> <p>Specify the yaml path, e.g. <code class="language-plaintext highlighter-rouge">deployments.api.container.secretEnv.PASSWORD.value</code>, the secret value <code class="language-plaintext highlighter-rouge">psst</code> and the environment.</p> <p><img src="../assets/run-encrypt-workflow.png" alt="" /></p> <p>The workflow will take the <code class="language-plaintext highlighter-rouge">CRYPT_MASTER_KEY</code>, stored in your repository, and encrypt the secret value. Then a pull request will be created, which you can review, approve and merge afterwards.</p> <p><img src="../assets/approve-password-pr.png" alt="" /></p> <p>üö® Never share the <code class="language-plaintext highlighter-rouge">CRYPT_MASTER_KEY</code> with anyone, this key can be used to decrypt all the secrets in your yaml file.</p> <p>‚ö†Ô∏è One drawback of the browser based approach is, that the secret value may be cached in the browser. Make sure the secret information is removed from the browser after running the workflow. In Chrome this can be done by going back to the input, navigating down with ‚Üì and delete the entry with Shift + Del.</p> <p><img src="../assets/autofill-secret.png" alt="" /></p> <p>You can rename the environment variable afterwards. Note, that encryption is environment specific as <code class="language-plaintext highlighter-rouge">CRYPT_MASTER_KEY</code>s are different, so you cannot copy the encrypted value from <code class="language-plaintext highlighter-rouge">int</code> to <code class="language-plaintext highlighter-rouge">prod</code>. Instead, run the encrypt workflow for both environments.</p> <p>When deploying an app, the <code class="language-plaintext highlighter-rouge">deploy-unity-app</code> action will validate that all secrets can be decrypted with the current <code class="language-plaintext highlighter-rouge">CRYPT_MASTER_KEY</code>. If decryption fails, the app cannot be deployed.</p> <h3 id="encrypt-via-gh"> <a href="#encrypt-via-gh" class="anchor-heading" aria-labelledby="encrypt-via-gh"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Encrypt via <code class="language-plaintext highlighter-rouge">gh</code> </h3> <p>Make sure <code class="language-plaintext highlighter-rouge">gh</code> is installed from <a href="https://cli.github.com">cli.github.com</a> and follow <a href="https://docs.github.com/en/enterprise-server/github-cli/github-cli/quickstart">GitHub CLI quickstart</a>.</p> <p>Next, from your repository run:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gh workflow run encrypt <span class="se">\</span>
  <span class="nt">-f</span> <span class="s2">"environment=int"</span> <span class="se">\</span>
  <span class="nt">-f</span> <span class="s2">"yaml-path=deployments.api.container.secretEnv.PASSWORD.value"</span> <span class="se">\</span>
  <span class="nt">-f</span> <span class="s2">"secret=psst"</span>
</code></pre></div></div> <h2 id="headers-and-cookies"> <a href="#headers-and-cookies" class="anchor-heading" aria-labelledby="headers-and-cookies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Headers and Cookies </h2> <p>You can also set custom headers or cookies to provide environment specific configuration for your app. See <a href="http-headers.html">HTTP Headers</a> for details.</p> <p>When using cookies, keep in mind that these mey be shared on the entire domain <code class="language-plaintext highlighter-rouge">unity.bmwgroup.net</code>. So it is recommended to use the following naming convention and config:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deployments</span><span class="pi">:</span>
  <span class="na">ui</span><span class="pi">:</span>
    <span class="na">headers</span><span class="pi">:</span>
      <span class="na">response</span><span class="pi">:</span>
        <span class="na">add</span><span class="pi">:</span>
          <span class="na">Set-Cookie</span><span class="pi">:</span> <span class="s">app-foo-ui-environment=int; Secure; SameSite=Strict; Path=/foo/ui</span>
</code></pre></div></div> <p>The name of the cookie <code class="language-plaintext highlighter-rouge">app-foo-ui-environment</code> should have the following segments:</p> <p><code class="language-plaintext highlighter-rouge">app-&lt;name&gt;-&lt;deployment&gt;-&lt;cookie-name&gt;</code></p> <ul> <li><code class="language-plaintext highlighter-rouge">&lt;name&gt;</code> name of your app</li> <li><code class="language-plaintext highlighter-rouge">&lt;deployment&gt;</code> name of the deployment (optional)</li> <li><code class="language-plaintext highlighter-rouge">&lt;cookie-name&gt;</code> name of the cookie value</li> </ul> <p>Setting <code class="language-plaintext highlighter-rouge">Path=/foo/ui</code> is also recommended. Check <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie">Set-Cookie on MDN</a> for more details.</p> <h2 id="prototypes"> <a href="#prototypes" class="anchor-heading" aria-labelledby="prototypes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prototypes </h2> <p>Prototypes are UNITY applications which are not meant for productive use. They are used only for trying out different solutions with real data. If the prototype needs to be converted to a real application, the BMW process for creating an application needs to be followed (creating an application in ConnectIT, etc). It is possible to mark a UNITY application as a prototype via a flag in the <code class="language-plaintext highlighter-rouge">unity-app-*.yaml</code> file:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">prototype</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div> <p>It is not possible to deploy an application on the UNITY production environment without either specifying an <code class="language-plaintext highlighter-rouge">appId</code> for it or marking it as a prototype.</p> <h2 id="environment-configuration-with-angular"> <a href="#environment-configuration-with-angular" class="anchor-heading" aria-labelledby="environment-configuration-with-angular"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Environment Configuration with Angular </h2> <p>Angular <a href="https://angular.io/guide/build#configuring-application-environments">recommends</a> building different artifacts for different environments such as int and prod. However, this is in contradiction to the concept of running the same docker images on all environments, which is a good practice to ensure environments are as close as possible. This approach is recommended by UNITY.</p> <p>To have minimal environment specific configuration of an angular app, a mechanism is required that does not need to build separate images for int and prod. The simplest approach is to store this information in a <a href="#headers-and-cookies">cookie</a>.</p> <p>Then, inside the app, that cookie can be accessed as follows:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Extract cookie value by name
 * @see https://stackoverflow.com/a/15724300/1458343
 */</span>
<span class="kd">const</span> <span class="nx">getCookie</span> <span class="o">=</span> <span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="s2">`; </span><span class="p">${</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">`; </span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2">=`</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span> <span class="p">?</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">pop</span><span class="p">()?.</span><span class="nx">split</span><span class="p">(</span><span class="dl">"</span><span class="s2">;</span><span class="dl">"</span><span class="p">)?.</span><span class="nx">shift</span><span class="p">()</span> <span class="p">:</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="p">};</span>

<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="dl">"</span><span class="s2">app-root</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">templateUrl</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./app.component.html</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">styleUrls</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">./app.component.scss</span><span class="dl">"</span><span class="p">],</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppComponent</span> <span class="p">{</span>
  <span class="c1">//Tag with environment for header</span>
  <span class="nl">environmentTagConfig</span><span class="p">:</span> <span class="nb">Partial</span><span class="o">&lt;</span><span class="nx">DsHeaderTagConfiguration</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">label</span><span class="p">:</span> <span class="nx">getCookie</span><span class="p">(</span><span class="dl">"</span><span class="s2">app-foo-ui-environment</span><span class="dl">"</span><span class="p">),</span>
  <span class="p">};</span>

  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <p>This little demo shows how the <code class="language-plaintext highlighter-rouge">environmentTagConfig</code> is set from a cookie <code class="language-plaintext highlighter-rouge">app-foo-ui-environment=int</code>. In the same way, other environment specific config may be loaded, such as a URL of an external system:</p> <p><em>gh.service.ts:</em></p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Injectable</span><span class="p">({</span>
  <span class="na">providedIn</span><span class="p">:</span> <span class="dl">'</span><span class="s1">root</span><span class="dl">'</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">GhService</span> <span class="p">{</span>

  <span class="k">private</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">getCookie</span><span class="p">(</span><span class="dl">"</span><span class="s2">app-foo-ui-gh-url</span><span class="dl">"</span><span class="p">)</span> <span class="o">??</span> <span class="dl">''</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">http</span><span class="p">:</span> <span class="nx">HttpClient</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

  <span class="nx">getOctocat</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span><span class="na">responseType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text</span><span class="dl">'</span><span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>To initialize the cookie for local development, add the following block:</p> <p><em>app.module.ts:</em></p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">isDevMode</span><span class="p">())</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="s2">`app-foo-ui-environment=dev; Secure; SameSite=Strict; Path=/foo/ui`</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="s2">`app-foo-ui-gh-url=https://api.github.com/octocat; Secure; SameSite=Strict; Path=/foo/ui`</span>
<span class="p">}</span>
</code></pre></div></div> <p>and in the <code class="language-plaintext highlighter-rouge">unity-app.*.yaml</code> files add the cookie config to use</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="na">headers</span><span class="pi">:</span>
      <span class="na">response</span><span class="pi">:</span>
        <span class="na">add</span><span class="pi">:</span>
          <span class="na">Set-Cookie</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">app-foo-ui-environment=foo; Secure; SameSite=Strict; Path=/foo/ui</span>
            <span class="pi">-</span> <span class="s">app-foo-ui-gh-url=https://api.github.com/octocat; Secure; SameSite=Strict; Path=/foo/ui</span>
</code></pre></div></div> <p>Which could be set as <code class="language-plaintext highlighter-rouge">app-foo-ui-gh-url=https://api.github.com/octocat</code></p> <p>An alternative approach would be serving environment specific parameters from a backend‚Äôs REST resource, which could be configured via <a href="#environment-variables">environment variables</a> or data in a database. Currently, environment variables cannot be used directly in a nginx deployment.</p> </div> </div> <div class="search-overlay"></div> </div> <script> var config = { theme: "dark" } ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script> </body> </html>
