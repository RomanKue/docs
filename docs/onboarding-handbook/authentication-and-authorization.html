<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/WADTFY/wadtfy-docs/assets/css/just-the-docs-default.css"> <script src="/WADTFY/wadtfy-docs/assets/js/vendor/lunr.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js"></script> <script src="/WADTFY/wadtfy-docs/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Authentication and Authorization | WADTFY</title> <meta name="generator" content="Jekyll v4.3.2" /> <meta property="og:title" content="Authentication and Authorization" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="WADTFY Docs" /> <meta property="og:description" content="WADTFY Docs" /> <link rel="canonical" href="https://pages.atc-github.azure.cloud.bmw/WADTFY/wadtfy-docs//WADTFY/wadtfy-docs/onboarding-handbook/authentication-and-authorization.html" /> <meta property="og:url" content="https://pages.atc-github.azure.cloud.bmw/WADTFY/wadtfy-docs//WADTFY/wadtfy-docs/onboarding-handbook/authentication-and-authorization.html" /> <meta property="og:site_name" content="WADTFY" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Authentication and Authorization" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"WADTFY Docs","headline":"Authentication and Authorization","url":"https://pages.atc-github.azure.cloud.bmw/WADTFY/wadtfy-docs//WADTFY/wadtfy-docs/onboarding-handbook/authentication-and-authorization.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Feather. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/WADTFY/wadtfy-docs/" class="site-title lh-tight"> WADTFY </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/WADTFY/wadtfy-docs/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Onboarding Handbook category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/WADTFY/wadtfy-docs/onboarding-handbook/" class="nav-list-link">Onboarding Handbook</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Cluster Handbook category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/WADTFY/wadtfy-docs/cluster-handbook/" class="nav-list-link">Cluster Handbook</a><ul class="nav-list "></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search WADTFY" aria-label="Search WADTFY" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://argocd.api-i.bmwgroup.net" class="site-button" > Int </a> </li> <li class="aux-nav-list-item"> <a href="https://argocd.api.bmwgroup.net" class="site-button" > Prod </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="">AppDev Handbook</a></li> <li class="breadcrumb-nav-list-item"><span>Authentication and Authorization</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><strong>Table of Contents</strong></p> <!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> <ul> <li><a href="#authentication-and-authorization">Authentication and Authorization</a> <ul> <li><a href="#authentication">Authentication</a> <ul> <li><a href="#excluded-paths">Excluded Paths</a></li> <li><a href="#excluded-headers">Excluded Headers</a></li> <li><a href="#oauth2">OAuth2</a></li> <li><a href="#minimum-authentication-level">Minimum Authentication Level</a></li> <li><a href="#k8s">K8s</a></li> </ul> </li> <li><a href="#authorization">Authorization</a> <ul> <li><a href="#b2x-roles">B2X Roles</a></li> <li><a href="#machine-to-machine-m2m">Machine-to-Machine (M2M)</a></li> <li><a href="#other-role-providers-rightnow-roma-active-directory-">Other Role Providers (RightNow, RoMa, Active Directory, â€¦)</a></li> </ul> </li> <li><a href="#user-information">User Information</a></li> </ul> </li> </ul> <!-- END doctoc generated TOC please keep comment here to allow auto update --> <h1 id="authentication-and-authorization"> <a href="#authentication-and-authorization" class="anchor-heading" aria-labelledby="authentication-and-authorization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Authentication and Authorization </h1> <p>Every UNITY app is protected by strong authentication (two-factor authentication with YubiKey) by default.</p> <p>ðŸš¨ Note that the YubiKey needs to be enabled on <a href="https://strong-int.bmwgroup.net">strong-int.bmwgroup.net</a> by every user, to be able to use it on the integration environment.</p> <p>The way, authentication is working can be configured in the <code class="language-plaintext highlighter-rouge">unity-app.*.yaml</code> files like shown below:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">auth</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">minAuthLevel</span><span class="pi">:</span> <span class="m">7000</span>
  <span class="na">oauth2</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">roles</span><span class="pi">:</span>
    <span class="na">b2x</span><span class="pi">:</span>
      <span class="na">any</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">B2B_I</span>
  <span class="na">k8s</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>
</code></pre></div></div> <p>Details on each attribute can be found in the <a href="./unity-app-yaml.md">unity-app schema</a>.</p> <h2 id="authentication"> <a href="#authentication" class="anchor-heading" aria-labelledby="authentication"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Authentication </h2> <p>As previously stated, each app is protected with authentication by default. In rare cases, this protection can be disabled by setting the <code class="language-plaintext highlighter-rouge">auth.enabled</code> flag to <code class="language-plaintext highlighter-rouge">false</code>. Note, that this will expose all endpoints publicly to the entire BMW intranet! Disabling authentication is recommended only, if the content is public, or if authentication and authorization is implemented on the application level. That means, the app development team is responsible for handling all traffic in a secure way.</p> <h3 id="excluded-paths"> <a href="#excluded-paths" class="anchor-heading" aria-labelledby="excluded-paths"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Excluded Paths </h3> <p>It is possible to exclude some paths from being access protected by authentication and authorization.</p> <p>For example, the OpenAPI endpoint or the SwaggerUI page could be made public by excluding it from authorization as shown blow.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">auth</span><span class="pi">:</span>
  <span class="na">excludedPaths</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">/my-app/api/open-api/swagger-ui</span>
    <span class="pi">-</span> <span class="s">/my-app/api/openapi</span>
</code></pre></div></div> <h3 id="excluded-headers"> <a href="#excluded-headers" class="anchor-heading" aria-labelledby="excluded-headers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Excluded Headers </h3> <p>It is possible disable the authentication and authorization depending on some headers values.</p> <p>It is possible to also use <a href="https://httpwg.org/specs/rfc7540.html#rfc.section.8.1.2.1">pseudo-headers</a>. For example, when the :method pseudo-header has one of the given values, there wonâ€™t be any authentication or authorization checks.</p> <p>The headers values are provided via a regular expression, which is in <a href="https://github.com/google/re2/wiki/Syntax">Google LE2 dialect</a>.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">auth</span><span class="pi">:</span>
  <span class="na">excludedHeaders</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">:method"</span>
      <span class="na">valuesRegex</span><span class="pi">:</span> <span class="s">OPTIONS|PATCH</span>
</code></pre></div></div> <h3 id="oauth2"> <a href="#oauth2" class="anchor-heading" aria-labelledby="oauth2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> OAuth2 </h3> <p>If the flag <code class="language-plaintext highlighter-rouge">auth.oauth.enabled</code> is set to <code class="language-plaintext highlighter-rouge">true</code>, an unauthenticated request will initiate a redirect to the WebEAM login screen.</p> <p><img src="../assets/login-screen.png" alt="" /></p> <p>This is the recommended setting for front-ends.</p> <p>REST services, that are called via <a href="https://en.wikipedia.org/wiki/XMLHttpRequest">XHR</a> requests, should typically not enable OAuth2. An unauthenticated call (due to invalid or expired token or cookie) to the back-end, should not respond with a redirect to a login-page, but with a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401">401 Unauthorized</a> status code. The calling web-page is responsible for reacting to this status code. The simplest possible way is to force a page reload, which will initiate the OAuth2 flow for the user.</p> <p>Here is a simple angular HTTP interceptor, which triggers the page reload.</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">Injectable</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">HttpErrorResponse</span><span class="p">,</span> <span class="nx">HttpEvent</span><span class="p">,</span> <span class="nx">HttpHandler</span><span class="p">,</span> <span class="nx">HttpInterceptor</span><span class="p">,</span> <span class="nx">HttpRequest</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/common/http</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">catchError</span><span class="p">,</span> <span class="nx">Observable</span><span class="p">,</span> <span class="nx">throwError</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UnauthorizedInterceptor</span> <span class="k">implements</span> <span class="nx">HttpInterceptor</span> <span class="p">{</span>
  <span class="nx">intercept</span><span class="p">(</span><span class="nx">req</span><span class="p">:</span> <span class="nx">HttpRequest</span><span class="o">&lt;</span><span class="nx">unknown</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">next</span><span class="p">:</span> <span class="nx">HttpHandler</span><span class="p">):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">HttpEvent</span><span class="o">&lt;</span><span class="nx">unknown</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="nx">req</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span>
      <span class="nx">catchError</span><span class="p">((</span><span class="na">error</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span> <span class="k">instanceof</span> <span class="nx">HttpErrorResponse</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">401</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">throwError</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">error</span><span class="p">);</span>
      <span class="p">}));</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>In addition, the interceptor must be added to the <code class="language-plaintext highlighter-rouge">providers</code> in the <code class="language-plaintext highlighter-rouge">AppModule</code>.</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="c1">// ...</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">multi</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">provide</span><span class="p">:</span> <span class="nx">HTTP_INTERCEPTORS</span><span class="p">,</span>
      <span class="na">useClass</span><span class="p">:</span> <span class="nx">UnauthorizedInterceptor</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">],</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="minimum-authentication-level"> <a href="#minimum-authentication-level" class="anchor-heading" aria-labelledby="minimum-authentication-level"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Minimum Authentication Level </h3> <p>By default, the highest auth level (7000) is required to authenticate to a UNITY app. Currently, users need to authenticate with a YubiKey as second factor to get the level 7000 authentication.</p> <p>If the application accepts request with lower auth levels as well, it may reduce the default <code class="language-plaintext highlighter-rouge">auth.minAuthLevel</code> to a lower value.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">auth</span><span class="pi">:</span>
  <span class="na">minAuthLevel</span><span class="pi">:</span> <span class="m">4000</span>
</code></pre></div></div> <p>Note that the user will still be redirected to a login-page which requests authenticating with a YubiKey. To redirect to a different login page, the OAuth2 flow must be initiated on the application level, as this is not supported by UNITY out of the box. This means,</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">auth</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>
</code></pre></div></div> <p>must be set for the UI and the SPA needs to handle the OAuth2 flow.</p> <p>A typical use case would be to serve only data with a low protection need on auth level 1000 (single factor authentication) and all data on authentication level 7000.</p> <p>The current userâ€™s auth level is passed as a custom header <code class="language-plaintext highlighter-rouge">Unity-AuthLevel</code> to the upstream backend, which can be evaluated in a Quarkus back-end like shown below.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Path</span><span class="o">(</span><span class="s">"/v1/"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthLevelResource</span> <span class="o">{</span>

    <span class="nd">@GET</span>
    <span class="nd">@Produces</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">TEXT_PLAIN</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">authLevel</span><span class="o">(</span><span class="nd">@HeaderParam</span><span class="o">(</span><span class="s">"Unity-AuthLevel"</span><span class="o">)</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">authLevel</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Your auth level is "</span> <span class="o">+</span> <span class="n">authLevel</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Read more about auth levels in the <a href="https://atc.bmwgroup.net/confluence/x/14S3KQ">WebEAM documentation</a>.</p> <h3 id="k8s"> <a href="#k8s" class="anchor-heading" aria-labelledby="k8s"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> K8s </h3> <p>If the flag <code class="language-plaintext highlighter-rouge">auth.k8s.enabled</code> is set to true, the application will be able to handle kubernetes <code class="language-plaintext highlighter-rouge">ServiceAccount</code> tokens.</p> <p>In order to connect to an application using the service account token you must set the <code class="language-plaintext highlighter-rouge">Authorization</code> header to <code class="language-plaintext highlighter-rouge">Bearer &lt;myAppsSaToken&gt;</code>. Additionally, the custom header <code class="language-plaintext highlighter-rouge">Unity-Authorization-Type</code> must be set to <code class="language-plaintext highlighter-rouge">Kubernetes-Service-Account</code> to differentiate these requests from the ones using WEN token.</p> <h2 id="authorization"> <a href="#authorization" class="anchor-heading" aria-labelledby="authorization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Authorization </h2> <p>Simple role requirements can be configured in the <code class="language-plaintext highlighter-rouge">unity-app.*.yaml</code> files.</p> <h3 id="b2x-roles"> <a href="#b2x-roles" class="anchor-heading" aria-labelledby="b2x-roles"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> B2X Roles </h3> <p>If the user requires a B2X role, like <code class="language-plaintext highlighter-rouge">PMD</code> or <code class="language-plaintext highlighter-rouge">B2B_I</code>, the following sample configuration can be employed.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">auth</span><span class="pi">:</span>
  <span class="na">roles</span><span class="pi">:</span>
    <span class="na">b2x</span><span class="pi">:</span>
      <span class="na">any</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">PMD</span>
        <span class="pi">-</span> <span class="s">B2B_I</span>
</code></pre></div></div> <p>This will reject any request with <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403">403 Forbidden</a>, if the user does not have either the <code class="language-plaintext highlighter-rouge">PMD</code> or the <code class="language-plaintext highlighter-rouge">B2B_I</code> role.</p> <p>More advance role checks must be performed in the applicationâ€™s back-end. Roles are passed as custom headers: <code class="language-plaintext highlighter-rouge">Unity-B2XRole</code>. Note that this header is repeated, if multiple roles are requested. Also note that only roles from the <code class="language-plaintext highlighter-rouge">auth.roles.b2x.any</code> list are passed in that header.</p> <p>In a Quarkus back-end, roles can be evaluated as follows.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Path</span><span class="o">(</span><span class="s">"/v1/"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RolesResource</span> <span class="o">{</span>

    <span class="nd">@GET</span>
    <span class="nd">@Produces</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">TEXT_PLAIN</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">roles</span><span class="o">(</span><span class="nd">@HeaderParam</span><span class="o">(</span><span class="s">"Unity-B2XRole"</span><span class="o">)</span> <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">roles</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Your roles are: "</span> <span class="o">+</span> <span class="nc">String</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s">", "</span><span class="o">,</span> <span class="n">roles</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="machine-to-machine-m2m"> <a href="#machine-to-machine-m2m" class="anchor-heading" aria-labelledby="machine-to-machine-m2m"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Machine-to-Machine (M2M) </h3> <p>It is possible to authorize <a href="https://atc.bmwgroup.net/confluence/x/ZYS3KQ">WebEAM M2M</a> client ids to access the applications. Optionally, for each of the authorized client ids, roles may be defined which will be afterwards passed to the application via the <code class="language-plaintext highlighter-rouge">Unity-B2XRole</code> header.</p> <p>The M2M authorization can be enabled via the <code class="language-plaintext highlighter-rouge">unity-app.*.yaml</code> files:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">auth</span><span class="pi">:</span>
  <span class="na">realm</span><span class="pi">:</span>
    <span class="na">machine2machine</span><span class="pi">:</span>
      <span class="na">client-id-1</span><span class="pi">:</span>
        <span class="na">roles</span><span class="pi">:</span>
          <span class="na">b2x</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">PMD</span>
            <span class="pi">-</span> <span class="s">B2B_I</span>
</code></pre></div></div> <p>If the client id is not allowed to access the application with any of the configured roles (defined in the <code class="language-plaintext highlighter-rouge">auth.roles</code> section), then response will be <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403">403 Forbidden</a>.</p> <p>Instead of the user information headers, in this case the <code class="language-plaintext highlighter-rouge">Unity-ClientId</code> header will be set to the M2M client id.</p> <h3 id="other-role-providers-rightnow-roma-active-directory-"> <a href="#other-role-providers-rightnow-roma-active-directory-" class="anchor-heading" aria-labelledby="other-role-providers-rightnow-roma-active-directory-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Other Role Providers (RightNow, RoMa, Active Directory, â€¦) </h3> <p>If the app requires to use a role provider, which is not integrated into UNITY, it must be handled on application level. This means, the <code class="language-plaintext highlighter-rouge">unity-app.*.yaml</code> file should contain a configuration, which only requests authentication:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">auth</span><span class="pi">:</span>
  <span class="na">oauth2</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div> <p>This will make sure, all requests passed to the application have a <code class="language-plaintext highlighter-rouge">Authorization: Bearer xyz...</code> header with a valid WebEAM Bearer token. With that token, any role provider can be used, either employing a custom implementation, or an extension.</p> <h2 id="user-information"> <a href="#user-information" class="anchor-heading" aria-labelledby="user-information"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> User Information </h2> <p>Some user (or M2M client id)â€™s attributes are passed as custom headers. The list below shows, what can be evaluated by the back-end:</p> <ul> <li><code class="language-plaintext highlighter-rouge">Unity-Email</code> e.g. <code class="language-plaintext highlighter-rouge">user@example.com</code></li> <li><code class="language-plaintext highlighter-rouge">Unity-B2XRole</code> e.g. <code class="language-plaintext highlighter-rouge">B2B_I</code></li> <li><code class="language-plaintext highlighter-rouge">Unity-AuthLevel</code> e.g. <code class="language-plaintext highlighter-rouge">7000</code></li> <li><code class="language-plaintext highlighter-rouge">Unity-UserName</code> e.g. <code class="language-plaintext highlighter-rouge">Charlie Brown</code></li> <li><code class="language-plaintext highlighter-rouge">Unity-UserSub</code> e.g. <code class="language-plaintext highlighter-rouge">q12345</code></li> <li><code class="language-plaintext highlighter-rouge">Unity-Department</code> e.g. <code class="language-plaintext highlighter-rouge">FG-123</code></li> <li><code class="language-plaintext highlighter-rouge">Unity-ClientId</code> e.g. <code class="language-plaintext highlighter-rouge">8eeb5128-87ad-48f3-a30b-631db0fb11e9</code> (header is not set for human users)</li> </ul> <p>For <a href="#machine-to-machine--m2m-">M2M</a> clients, only the following headers will be present: <code class="language-plaintext highlighter-rouge">Unity-B2XRole</code> and <code class="language-plaintext highlighter-rouge">Unity-ClientId</code>.</p> </div> </div> <div class="search-overlay"></div> </div> <script> var config = { theme: "dark" } ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script> </body> </html>
