<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/WADTFY/wadtfy-docs/assets/css/just-the-docs-default.css"> <script src="/WADTFY/wadtfy-docs/assets/js/vendor/lunr.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js"></script> <script src="/WADTFY/wadtfy-docs/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Certificates | WADTFY</title> <meta name="generator" content="Jekyll v4.3.2" /> <meta property="og:title" content="Certificates" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="WADTFY Docs" /> <meta property="og:description" content="WADTFY Docs" /> <link rel="canonical" href="https://pages.atc-github.azure.cloud.bmw/WADTFY/wadtfy-docs//WADTFY/wadtfy-docs/onboarding-handbook/certificates.html" /> <meta property="og:url" content="https://pages.atc-github.azure.cloud.bmw/WADTFY/wadtfy-docs//WADTFY/wadtfy-docs/onboarding-handbook/certificates.html" /> <meta property="og:site_name" content="WADTFY" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Certificates" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"WADTFY Docs","headline":"Certificates","url":"https://pages.atc-github.azure.cloud.bmw/WADTFY/wadtfy-docs//WADTFY/wadtfy-docs/onboarding-handbook/certificates.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Feather. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/WADTFY/wadtfy-docs/" class="site-title lh-tight"> WADTFY </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/WADTFY/wadtfy-docs/" class="nav-list-link">Home</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in AppDev Handbook category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/WADTFY/wadtfy-docs/app-dev-handbook/" class="nav-list-link">AppDev Handbook</a><ul class="nav-list "><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/getting-started.html" class="nav-list-link">Getting Started</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/unity-app-yaml.html" class="nav-list-link">Unity App Yaml</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/connect-it.html" class="nav-list-link">Connect IT</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/app-configuration.html" class="nav-list-link">App Configuration</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/authentication-and-authorization.html" class="nav-list-link">Authentication and Authorization</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/resources.html" class="nav-list-link">Resources</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/urls.html" class="nav-list-link">URLs</a></li><li class="nav-list-item active"><a href="/WADTFY/wadtfy-docs/onboarding-handbook/certificates.html" class="nav-list-link active">Certificates</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/security.html" class="nav-list-link">Security</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/telemetry.html" class="nav-list-link">Telemetry</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/external-services.html" class="nav-list-link">External Services</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/http-headers.html" class="nav-list-link">HTTP Headers</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/maven-packages.html" class="nav-list-link">Maven Packages</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/kubernetes.html" class="nav-list-link">Kubernetes</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/diagnostics.html" class="nav-list-link">Diagnostics</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/postgresql-flexible-server.html" class="nav-list-link">PostgreSQL Flexible Server</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/onboarding-handbook/decommissioning-app.html" class="nav-list-link">Decommission App</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in DevOps Handbook category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/WADTFY/wadtfy-docs/cluster-handbook/" class="nav-list-link">DevOps Handbook</a><ul class="nav-list "><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/architecture.html" class="nav-list-link">Architecture</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/networking.html" class="nav-list-link">Networking</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/kubernetes.html" class="nav-list-link">Kubernetes</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/envoy.html" class="nav-list-link">Envoy</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/certs.html" class="nav-list-link">Certs</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/technical-accounts.html" class="nav-list-link">Technical Accounts</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/regular-activities.html" class="nav-list-link">Regular Activities</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/incident-recovery.html" class="nav-list-link">Incident Recovery</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/database-incident-recovery.html" class="nav-list-link">Database Incident Recovery</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/alerts.html" class="nav-list-link">Alerts</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/restore-decommissioned-app.html" class="nav-list-link">Restore decommission App</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/cluster-migration.html" class="nav-list-link">Cluster Migration</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/references.html" class="nav-list-link">References</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/accesses.html" class="nav-list-link">Accesses</a></li><li class="nav-list-item "><a href="/WADTFY/wadtfy-docs/cluster-handbook/postgresql-flexible-server.html" class="nav-list-link">PostgreSQL Flexible Server</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search WADTFY" aria-label="Search WADTFY" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://argocd.api-i.bmwgroup.net" class="site-button" > Int </a> </li> <li class="aux-nav-list-item"> <a href="https://argocd.api.bmwgroup.net" class="site-button" > Prod </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/WADTFY/wadtfy-docs/app-dev-handbook/">AppDev Handbook</a></li> <li class="breadcrumb-nav-list-item"><span>Certificates</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><strong>Table of Contents</strong></p> <!-- START doctoc generated TOC please keep comment here to allow auto update --> <!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --> <ul> <li><a href="#certificates">Certificates</a> <ul> <li><a href="#ingress">Ingress</a></li> <li><a href="#egress">Egress</a> <ul> <li><a href="#unity-app-services">UNITY App Services</a></li> <li><a href="#other-services">Other Services</a></li> </ul> </li> </ul> </li> </ul> <!-- END doctoc generated TOC please keep comment here to allow auto update --> <h1 id="certificates"> <a href="#certificates" class="anchor-heading" aria-labelledby="certificates"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Certificates </h1> <p>Good news, UNITY handles all certificates for you! This section clarifies how UNITY does that.</p> <h2 id="ingress"> <a href="#ingress" class="anchor-heading" aria-labelledby="ingress"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ingress </h2> <p>The following diagram illustrates TLS termination for ingress traffic:</p><pre><code class="language-mermaid">graph TB
subgraph UNITY
    subgraph pod
        envoy-- HTTP request --&gt;main
        main-- HTTP response --&gt;envoy
    end
end
client-- HTTPS request --&gt;envoy
envoy-- HTTPS response --&gt;client
</code></pre><p>In this diagram, envoy terminates TLS traffic from the client and encrypts traffic with a certificate and key, provided by UNITY. Traffic inside the pod can then be handled via plain HTTP. The application does not need to handle a certificate key to encrypt traffic.</p> <h2 id="egress"> <a href="#egress" class="anchor-heading" aria-labelledby="egress"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Egress </h2> <p>The following diagram illustrates TLS termination for egress traffic:</p><pre><code class="language-mermaid">graph TB
subgraph UNITY
    subgraph pod
        envoy-- HTTP response --&gt;main
        main-- HTTP request --&gt;envoy
    end
end
service-- HTTPS response --&gt;envoy
envoy-- HTTPS request --&gt;service
</code></pre><p>In this diagram, the app acts a client and calls the external service through envoy. Envoy has a trust store configured, which contains all current certificate trusted in the BMW organization. Certificates are validated using this trust store. The app itself does not need to handle any trust stores or certificates.</p> <h3 id="unity-app-services"> <a href="#unity-app-services" class="anchor-heading" aria-labelledby="unity-app-services"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> UNITY App Services </h3> <p>Unity integrates some services on port <code class="language-plaintext highlighter-rouge">8008</code>. This means, UNITY managed services can be called on that port. Here is an example on how to do this in a Quarkus app:</p> <p><code class="language-plaintext highlighter-rouge">application.properties</code></p> <div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">quarkus.rest-client.services.url</span><span class="p">=</span><span class="s">http://localhost:8008/services/api</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">DevModelRangeSearch.java</code></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RegisterRestClient</span><span class="o">(</span><span class="n">configKey</span> <span class="o">=</span> <span class="s">"services"</span><span class="o">)</span>
<span class="nd">@Consumes</span><span class="o">({</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">})</span>
<span class="nd">@Produces</span><span class="o">({</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">})</span>
<span class="nd">@Path</span><span class="o">(</span><span class="s">"pip-vehicle/dev-model-ranges/v2:search"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">DevModelRangeSearch</span> <span class="o">{</span>

    <span class="nd">@POST</span>
    <span class="nc">CompletionStage</span><span class="o">&lt;</span><span class="nc">PipSearchResultDO</span><span class="o">&lt;</span><span class="nc">DevModelRangeDO</span><span class="o">&gt;&gt;</span>
    <span class="nf">searchAsync</span><span class="o">(</span><span class="nc">DevModelRangeSearchDO</span> <span class="n">devModelRangeSearchDO</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="other-services"> <a href="#other-services" class="anchor-heading" aria-labelledby="other-services"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Other Services </h3> <p>To integrate other external services, the <code class="language-plaintext highlighter-rouge">unity-app.*.yaml</code> files need to be adjusted like shown below:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deployments</span><span class="pi">:</span>
  <span class="na">api</span><span class="pi">:</span>
    <span class="c1"># ...</span>
    <span class="na">proxyPorts</span><span class="pi">:</span>
      <span class="na">9000</span><span class="pi">:</span>
        <span class="na">host</span><span class="pi">:</span>
          <span class="s">example.com</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
</code></pre></div></div> <p>This proxy port config will allow calling <code class="language-plaintext highlighter-rouge">https://example.com</code> on <code class="language-plaintext highlighter-rouge">http://localhost:9000</code> from the app’s container.</p> <p>More detailed, TLS will be terminated by the envoy proxy and exposed as http endpoint without TLS inside the pod. One caveat may be a redirect response from the external service pointing to another host. If the app’s client is configured such that it follows redirects, it may fail to connect the host from the <code class="language-plaintext highlighter-rouge">Location</code> header.</p> <p>Here is a specific example.</p> <p>The app calls <code class="language-plaintext highlighter-rouge">https://example.com</code> via <code class="language-plaintext highlighter-rouge">http://localhost:9000</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET http://localhost:9000/foo/bar

&lt; Location: https://another-example.com/foo/bar
</code></pre></div></div> <p>This will most likely fails, since <code class="language-plaintext highlighter-rouge">https://another-example.com</code> is not trusted. It is recommended to no follow redirects from within the app’s client and configure the correct host in the app. If this cannot be done, the app must manage the trust store itself by adding relevant certificates to the app image trust store and the <code class="language-plaintext highlighter-rouge">proxyPorts</code> feature cannot be used.</p> <p>The default protocol for <code class="language-plaintext highlighter-rouge">proxyPorts</code> is HTTP. However, other protocols are also supported. This is specified by the type property.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">deployments</span><span class="pi">:</span>
  <span class="na">api</span><span class="pi">:</span>
    <span class="c1"># ...</span>
    <span class="na">proxyPorts</span><span class="pi">:</span>
      <span class="na">9000</span><span class="pi">:</span>
        <span class="na">host</span><span class="pi">:</span>
          <span class="s">groupdir.bmwgroup.net</span>
        <span class="na">port</span><span class="pi">:</span> <span class="m">636</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
</code></pre></div></div> <p>In this example, the application can connect (via JNDI, for example) to LDAP. The connection will be secure in this case, UNITY will handle all SSL certificate handling.</p> </div> </div> <div class="search-overlay"></div> </div> <script> var config = { theme: "dark" } ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script> </body> </html>
